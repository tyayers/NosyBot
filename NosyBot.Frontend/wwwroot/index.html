<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>WUW?</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="js/bootstrap.min.css" type="text/css">
    <link href="js/jqvmap.css" media="screen" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="css/wuw.css" type="text/css" />

    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jquery.vmap.js"></script>
    <script type="text/javascript" src="js/jquery.vmap.world.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery.vmap.sampledata.js"></script>

    <script>

        var displayLanguage = "en";

        jQuery(document).ready(function () {
            jQuery('#vmap').vectorMap({
                map: 'world_en',
                backgroundColor: '#E9ECEF',
                color: '#ffffff',
                hoverOpacity: 0.7,
                selectedColor: '#666666',
                enableZoom: false,
                showTooltip: true,
                scaleColors: ['#C8EEFF', '#006491'],
                values: sample_data,
                normalizeFunction: 'polynomial',
                onRegionClick: function (element, code, region) {
                    var message = 'You clicked "'
                        + region
                        + '" which has the code: '
                        + code.toUpperCase();



                    $.get("api/news/" + code + "?count=100&displayLanguage=" + displayLanguage, function (data) {

                        if (data != undefined) {

                            //$("#modal-news").html("<button type='button' class='list-group-item list-group-item-action active'>Stories crazy stuff!</button>");
                            $("#modal-news").html("");

                            for (var i in data) {
                                var story = data[i];
                                $("#modal-news").append(getStoryDiv(story["translatedTitle"], story["url"], story["logoUrl"], "img/countries/" + story["country"] + ".png"));
                            }
                        }
                    });

                    $('#storiesModal').modal();
                    //alert(message);
                }
            });

            //$('#vmap').css("height", $(document).height() * .75);

            refreshGlobalStories();
        });

        $(document).ready(ajustamodal);
        $(window).resize(ajustamodal);

        function refreshGlobalStories() {
            $.get("api/news?count=7&displayLanguage=" + displayLanguage, function (data) {

                $("#americas-top-news").html("<button type='button' class='list-group-item list-group-item-action active'>Americas</button>");
                $("#emea-top-news").html("<button type='button' class='list-group-item list-group-item-action active'>EMEA</button>");
                $("#apac-top-news").html("<button type='button' class='list-group-item list-group-item-action active'>APAC</button>");

                if (data["americas"] != undefined) {
                    for (var i in data["americas"]) {
                        var story = data["americas"][i];
                        $("#americas-top-news").append(getStoryDiv(story["translatedTitle"], story["url"], story["logoUrl"], "img/countries/" + story["country"] + ".png"));
                    }
                }

                if (data["emea"] != undefined) {
                    for (var i in data["emea"]) {
                        var story = data["emea"][i];
                        $("#emea-top-news").append(getStoryDiv(story["translatedTitle"], story["url"], story["logoUrl"], "img/countries/" + story["country"] + ".png"));
                    }
                }

                if (data["apac"] != undefined) {
                    for (var i in data["apac"]) {
                        var story = data["apac"][i];
                        $("#apac-top-news").append(getStoryDiv(story["translatedTitle"], story["url"], story["logoUrl"], "img/countries/" + story["country"] + ".png"));
                    }
                }
            });
        }

        function getStoryDiv(title, storyUrl, logoUrl, countryUrl) {
            // return "<a class='list-group-item list-group-item-action container' target='_blank' href='" + storyUrl + "' role='button'><img src='" + countryUrl + "' style='width:30px;'/><br><img src='" + logoUrl + "' style='width:30px;'/> " + title + "</a>";
            //return "<div class='list-group-item list-group-item-action container'><div class='row'><div class='col-2'><div style='margin-bottom: 3px;'><img src='" + countryUrl + "' style='width:30px;'/></div><div><img src='" + logoUrl + "' style='width:30px;'/></div></div><div class='col-10'><a target='_blank' href='" + storyUrl + "' role='button'>" + title + "</a></div></div>";
            return "<ul class='story-container list-group-item list-group-item-action'><li class='story-item story-icons'><div><div style='margin-bottom: 5px;'><img src='" + countryUrl + "' style='width:30px;'/></div><div><img src='" + logoUrl + "' style='width:30px;'/></div></div><li class='story-item story-text'><a target='_blank' href='" + storyUrl + "' role='button'>" + title + "</a></li></ul>";
        }

        function ajustamodal() {
            var altura = $(window).height() - 180; //155; //value corresponding to the modal heading + footer
            $(".modal-scroll").css({ "height": altura, "overflow-y": "auto" });
        }

        function setDisplayLanguage(language) {
            displayLanguage = language;
            refreshGlobalStories();
        }
      
    </script>
  </head>
  <body>
      <nav class="navbar navbar-expand-lg navbar-light navbar-center bg-light sticky-top">
          <a class="navbar-brand" style="color: rgba(0, 0, 0, 0.5) ;" href="#">
              <img src="img/world2.png" width="30" height="30" class="d-inline-block align-top" alt="" />
              What's Up World?
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavDropdown">
              <ul class="navbar-nav">
                  <li class="nav-item active">
                      <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="#">About</a>
                  </li>
                  <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Language
                      </a>
                      <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                          <a class="dropdown-item" href="#" onclick="setDisplayLanguage('en')">English</a>
                          <a class="dropdown-item" href="#" onclick="setDisplayLanguage('de')">Deutsch</a>
                      </div>
                  </li>
              </ul>
          </div>
      </nav>

      <div class="jumbotron">
          <h1 class="display-4">Hello World!</h1>
          <p class="lead">This is a simple web app to bing quality news together worldwide, and make it easy to see what's up everywhere around this beautiful globe.  The news story titles are translated in your chosen language, which you can change at any time under "Language" above in the menu bar.</p>
          <p class="lead">Simply click on a country below to see the translated news from there, or scroll down to the global region consolidated view below.</p>
          <hr class="my-4" />
          <p><div id="vmap" style="width: 100%; height: 86vh;"></div></p>
          <p class="lead">
              <a class="btn btn-primary btn-lg" href="#" role="button">How do I use it?</a>
          </p>
      </div>

      

      <div id="main-container" class="container-fluid">
          <div class="row">
              <div class="col-sm">
                  <div id="americas-top-news" class="list-group">
                      <button type="button" class="list-group-item list-group-item-action active">
                          Americas
                      </button>
                  </div>
              </div>
              <div class="col-sm">
                  <div id="emea-top-news" class="list-group">
                      <button type="button" class="list-group-item list-group-item-action active">
                          EMEA
                      </button>
                  </div>
              </div>
              <div class="col-sm">
                  <div id="apac-top-news" class="list-group">
                      <button type="button" class="list-group-item list-group-item-action active">
                          APAC
                      </button>
                  </div>
              </div>
          </div>
      </div>

      <!-- Stories Modal -->
      <div class="modal fade" id="storiesModal" tabindex="-1" role="dialog" aria-labelledby="storiesModalTitle" aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLongTitle">Stories crazy stuff!</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body modal-scroll">
                      <div id="modal-news" class="list-group">
                          <!--<button type="button" class="list-group-item list-group-item-action active">
                            Stories crazy stuff!
                        </button>-->
                      </div>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  </div>
              </div>
          </div>
      </div>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  </body>
</html>
